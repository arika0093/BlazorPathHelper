# BlazorPathHelper
[![NuGet Version](https://img.shields.io/nuget/v/BlazorPathHelper?style=for-the-badge&logo=NuGet&color=%2308C)](https://www.nuget.org/packages/BlazorPathHelper/) ![GitHub License](https://img.shields.io/github/license/arika0093/BlazorPathHelper?style=for-the-badge&logo=Apache)

![GitHub Actions Workflow Status](https://img.shields.io/github/actions/workflow/status/arika0093/BlazorPathHelper/release.yaml?branch=main&label=Release&style=flat-square) ![GitHub last commit (branch)](https://img.shields.io/github/last-commit/arika0093/BlazorPathHelper?style=flat-square)

`BlazorPathHelper` is a library that assists in managing URL paths within Blazor projects.

## Main Features
This library automatically generates the following contents.
* **Type-safe** URL builders from URL definitions
  * supports parameter/optional parameter/queries
* Menu structure data
  * Supports customizing menu display (icon, description, l10n, etc.)
* Route/Parameter/SupplyParameterFromQuery definition

## Getting Started
### Installation
Install [BlazorPathHelper](https://www.nuget.org/packages/BlazorPathHelper/) in your Blazor project.

```bash
dotnet add package BlazorPathHelper
```

### Preparation
Create a `WebPaths.cs` file.

```csharp
using BlazorPathHelper;
using Microsoft.AspNetCore.Components;

namespace BlazorPathHelper.Try;

[BlazorPath] // <- Add this attribute
public partial class WebPaths
{
    // [Item("Menu name"), Page<PageComponent>, Query<QueryClass>]
    // public const string VariableName = "/path";  
    [Item("TopPage"), Page<Home>]
    public const string Index = "/";
    [Item("Sample1a"), Page<Sample>]
    public const string Sample = "/sample";
    [Item("Sample1b"), Page<SampleChild>]
    public const string SampleChild = "/sample/child";
    [Item("Sample2a"), Page<Counter>]
    public const string Counter = "/counter";
    [Item("Sample2b"), Page<Counter2>]
    public const string CounterWithState = "/counter/{count:int}";
    [Item("Sample2c"), Page<Counter3>, Query<QueryRecord>]
    public const string CounterWithQuery = "/counter/query";
}

// ---
// definition for explanation (actually defined in each component)
public partial class Home : ComponentBase;
public partial class Sample : ComponentBase;
public partial class SampleChild : ComponentBase;
public partial class Counter : ComponentBase;
public partial class Counter2 : ComponentBase;
public partial class Counter3 : ComponentBase;
public record QueryRecord(string query = "hello", int page = 0, bool? opt = null);
```

This will automatically generate the following class definition.

<details>
<summary><strong>URL Builder</strong></summary>

```csharp
// <auto-generated />
public partial class WebPaths
{
  // Helper functions useful for building URLs
  public partial class Helper
  {
    public static string Index() => "/";
    public static string Sample() => "/sample";
    public static string SampleChild() => "/sample/child";
    public static string Counter() => "/counter";
    public static string CounterWithState(int Count)
      => string.Format("/counter/{0}", ToStringForUrl(Count));
    public static string CounterWithQuery(QueryRecord __query)
      => string.Format("/counter/query{0}", BuildQuery([
        ToEscapedStrings("query", __query.query),
        ToEscapedStrings("page", __query.page),
        ToEscapedStrings("opt", __query.opt)
      ]));
  }
}
```

</details>

<details>
<summary><strong>Menu structure data</strong></summary>

```csharp
// <auto-generated />
public partial class WebPaths
{
  // An array useful for dynamically creating menu items
  public static readonly BlazorMenuItem[] MenuItem = [
    new BlazorPathMenuItem(){
      Name = "Home", // Menu name. Defaults to the variable name
      Path = "/",    // Page path
      Children = []  // Submenus
      // Other properties automatically generated to assist in menu creation
    },
    new BlazorPathMenuItem(){
      Name = "Sample1a",
      Path = "/sample", 
      // Parses the URL and intelligently generates submenus
      Children = [
        new BlazorPathMenuItem(){
          Name = "Sample1b",
          Path = "/sample/child", 
          Children = []
        }
      ]
    },
    new BlazorPathMenuItem(){
      Name = "Sample2a",
      Path = "/counter",
      // Pages with parameters/queries are not displayed in the menu
      Children = []
    }
}
```

</details>

<details>
<summary><strong>Route/Parameter/SupplyParameterFromQuery definition</strong></summary>

```csharp
// <auto-generated />

// e.g. Index(Home)
[Route("/")] // -> be equal to [@page "/"] in .razor file
public partial class Home;

// e.g. CounterWithState(Counter2)
[Route("/counter/{count:int}")]
public partial class Counter2
{
  // automatically defined as a parameter
  [Parameter]
  public int Count { get; set; }
}

// e.g. CounterWithQuery(Counter3)
[Route("/counter/query")]
public partial class Counter3
{
  // automatically defined as a query parameter
  [SupplyParameterFromQuery]
  public string Query { get; set; } = "hello";
  [SupplyParameterFromQuery]
  public int Page { get; set; } = 0;
  [SupplyParameterFromQuery]
  public bool? Opt { get; set; } = null;
}
```

</details>



## Usage
### URL Builder
`(ClassName).Helper.(VariableName)` is the URL builder function.

```csharp
// Generate URL
var homeUrl = WebPaths.Helper.Index();
var counterStateUrl = WebPaths.Helper.CounterWithState(1);
var counterQueryUrl = WebPaths.Helper.CounterWithQuery(new() { query = "test" });

Console.WriteLine(homeUrl);         // -> "/"
Console.WriteLine(counterStateUrl); // -> "/counter/1"
Console.WriteLine(counterQueryUrl); // -> "/counter/query?query=test"

// navigate to page
// @inject NavigationManager Nav
Nav.NavigateTo(counterQueryUrl);
```

### Menu Generation
#### Setup
Create `NavMenuItem.razor`.

```razor
@* NavMenuItem.razor *@
@using BlazorPathHelper

@* A component that recursively displays menu items *@
@* The key attribute can use MenuItem.Index *@
<div>
  <NavLink href="@MenuItem.Path" Match="@NavLinkMatch.All">
    <span class="@MenuItem.Icon" aria-hidden="true"></span>
    @MenuItem.Name
  </NavLink>

  @* Submenus *@
  @foreach(var childMenuItem in MenuItem.Children)
  {
    <NavMenuItem @key=@childMenuItem.Key MenuItem="childMenuItem"/>
  }
</div>

@code {
  [Parameter, EditorRequired]
  public BlazorPathMenuItem MenuItem { get; set; } = default!;
}
```

#### Usage
You can display dynamically created menus by calling them as follows.

```razor
<nav>
  @foreach (var menuItem in WebPaths.MenuItem)
  {
    <NavMenuItem @key=@menuItem.Key MenuItem="menuItem"/>
  }
</nav>
```

#### Menu Customization
You can customize menu display using the `Item` attribute.

```csharp
[BlazorPath]
public partial class WebPaths
{
  // To hide from the menu, specify Visible = false
  [Item(Visible = false)]
  public const string Index = "/";

  // Specify page name and icon (CSS class)
  [Item("SampleA", Icon = "fas fa-cog")]
  public const string Sample = "/sample";
  [Item("SampleA-1", Icon = "fas fa-star")]
  public const string SampleChild1 = "/sample/child1";

  // ... or specify the icon as a Type (for FluentUI, etc.)
  // usage. Icon="@((Icon?)MenuItem.Icon)"
  [Item<Icon.Home>("SampleWithTypeIcon")]
  public const string SampleWithTypeIcon = "/sample/icontype";

  // To add a description, specify it as the Description
  [Item("SampleA-2", Description = "Description of the A-2 page")]
  public const string SampleWithDesc = "/sample/child2";

  // To recognize as a child element without URL connection, specify Group
  [Item("SampleA-3", Group = Sample)]
  public const string SampleChild3 = "/sample-3";

  // To display a deeply nested hierarchy that is not connected
  // to anything as a top-level menu, specify Group = "/"
  [Item("SampleB", Group = Index)]
  public const string SuperInnerItem = "/hoge/fuga/piyo";

  // If specified as above, child pages will also be displayed in the menu
  [Item("SampleB-1")]
  public const string SuperInnerItemChild = "/hoge/fuga/piyo/child";

  // For i10n support, use nameof to specify resource keys and use IStringLocalizer in components.
  // example.
  // @inject ILocalizer<Resources> Localizer
  // <NavLink href="@MenuItem.Path">@Localizer[MenuItem.Name]</NavLink>
  [Item(nameof(Resources.SampleTitle))]
  public const string SampleLocalize = "/sample-l10n";
  [Item(nameof(Resources.SampleTitle), Description = nameof(Resources.SampleDesc))]
  public const string SampleLocalizeWithDesc = "/sample-l10n-plus";
}
```

### Implementation Examples for Each Framework
#### Blazor Template

Since the standard template does not include icons, add the following to `index.html`.

```html
<head>
    <!-- add it -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
```

Then, use it as follows.

```csharp
// WebPaths.cs
[BlazorPath]
public partial class WebPaths
{
    [Item(Name="Home", Icon="bi-house-door-fill")]
    public const string Home = "/";
    [Item(Name="Sample1", Icon="bi-1-circle-fill")]
    public const string Sample1 = "/sample1";
    [Item(Name="Sample2", Icon="bi-2-circle-fill")]
    public const string Sample2 = "/sample2";
    [Item(Name="Sample3", Icon="bi-3-circle-fill")]
    public const string Sample3 = "/sample3";
}
```

```razor
@* NavMenuItem.razor *@
@using BlazorPathHelper

<div class="nav-item ps-3 py-1">
  <NavLink class="nav-link" href="@MenuItem.Path"
    Match="@(MenuItem.Path != "/" ? NavLinkMatch.Prefix : NavLinkMatch.All)">
    <span class="me-2 fs-5 @MenuItem.Icon" aria-hidden="true"></span>
    @MenuItem.Name
  </NavLink>
  @foreach(var childMenuItem in MenuItem.Children)
  {
    <nav class="flex-column">
      <NavMenuItem @key=@childMenuItem.Key MenuItem="childMenuItem"/>
    </nav>
  }
</div>

@code {
  [Parameter, EditorRequired]
  public BlazorPathMenuItem MenuItem { get; set; } = default!;
}
```

Implementation examples are available in [Example.Plain](./examples/Example.Plain/).

#### FluentUI

Since FluentUI's `Icon` cannot be specified as is, extract the name part and specify it.

```csharp
using BlazorPathHelper;
// To shorten, use using static
using static Microsoft.FluentUI.AspNetCore.Components.Icons.Regular.Size20;

[BlazorPath]
public partial class WebPaths
{
    // Specify the icon with Item<T>
    // ---------------------------------
    [Item<Home>("Home")]
    public const string Home = "/";
    [Item<TextHeader1>("Sample1")]
    public const string Sample1 = "/sample1";
    [Item<TextHeader2>("Sample2")]
    public const string Sample2 = "/sample2";
    [Item<TextHeader3>("Sample3")]
    public const string Sample3 = "/sample3";
}
```

Then, use it as follows.
  
```razor
@* NavMenuItem.razor *@
@using BlazorPathHelper

@if(MenuItem.HasChildren)
{
  <FluentNavGroup Href="@MenuItem.Path" Title="@MenuItem.Name" Icon="@((Icon?)MenuItem.Icon)">    
    @foreach(var childMenuItem in MenuItem.Children)
    {
      <NavMenuItem @key=@childMenuItem.Key MenuItem="childMenuItem"/>
    }
  </FluentNavGroup>
}
else
{
  <FluentNavLink Href="@MenuItem.Path" Icon="@((Icon?)MenuItem.Icon)" IconColor="Color.Accent">
      @MenuItem.Name
  </FluentNavLink>
}

@code {
  [Parameter, EditorRequired]
  public BlazorPathMenuItem MenuItem { get; set; } = default!;
}
```

Implementation examples are available in [Example.FluentUI](./examples/Example.FluentUI/).

#### AntBlazor

The standard template (Pro) includes a feature to generate menus from objects, but the generation of these definitions can be simplified.

```csharp
// Layout/BasicLayout.razor.cs
protected override async Task OnInitializedAsync()
{
  _menuData = ConverterMenuDataItem(WebPaths.MenuItem);
}

private MenuDataItem[] ConverterMenuDataItem(BlazorPathMenuItem[] items)
{
  return items.Select(item => new MenuDataItem {
    Path = item.Path,
    Name = item.Name,
    Key = item.Index.ToString(),
    Icon = item.Icon?.ToString(),
    Children = item.HasChildren
      ? ConverterMenuDataItem(item.Children) : null
  }).ToArray();
}
```

Then, it's the same as others.

```csharp
// WebPaths.cs
using BlazorPathHelper;

[BlazorPath]
public partial class WebPaths
{
  [Item("Home", Icon = "home")]
  public const string Home = "/";
  [Item("Sample1", Icon = "folder")]
  public const string Sample1 = "/sample1";
  [Item("Sample2", Icon = "folder")]
  public const string Sample2 = "/sample2";
  [Item("Sample3", Icon = "file")]
  public const string Sample3 = "/sample3";
}
```

of course, it can be used with the standard AntBlazor.

```razor
@* StandardMenuItem.razor *@
@using BlazorPathHelper

@if(MenuItem.HasChildren)
{
  <SubMenu Key=@MenuItem.Key>
    <TitleTemplate>
      <Icon Type=@(MenuItem.Icon?.ToString()) Theme="outline" />
      <span>@MenuItem.Name</span>
    </TitleTemplate>
    <ChildContent>
      @foreach (var childMenuItem in MenuItem.Children)
      {
        <StandardMenuItem @key=childMenuItem.Key MenuItem=childMenuItem />
      }
    </ChildContent>
  </SubMenu>
}
else
{
  <MenuItem RouterLink="@MenuItem.Path" Key=@MenuItem.Key>
      <Icon Type=@(MenuItem.Icon?.ToString()) Theme="outline" />
      <span>@MenuItem.Name</span>
  </MenuItem>    
}

@code {
  [Parameter, EditorRequired]
  public BlazorPathMenuItem MenuItem { get; set; } = default!;
}
```

Implementation examples are available in [Example.AntBlazor](./examples/Example.AntBlazor/).
